<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta content="IE=edge" http-equiv="X-UA-Compatible">
        <meta content="width=device-width" name="viewport">
        <meta content="true" name="HandheldFriendly">
        <meta content="yes" name="apple-mobile-web-app-capable">
        <meta content="black" name="apple-mobile-web-app-status-bar-style">
        <link href="/static/img/favicon.ico" rel="icon">
        <!-- site properties -->
        <title>
   Christophers Tips
        </title>
        <meta content="" name="description">
        <meta content="Christopher Pickering" name="author">
        <meta content="" name="keywords">
        <!-- typekit -->
        <link href="https://use.typekit.net/wtg5gdq.css" rel="stylesheet">
        <!-- styles -->
        <link href="/static/css/CACHE/755f7.css" rel="stylesheet">
        <link href="/static/css/CACHE/755f7.css" rel="stylesheet">
        <!-- fontawesome -->
        <link href="/static/css/all.css" rel="stylesheet">
        <!-- google analytics -->
        <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-127293191-1">
        </script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() {
                dataLayer.push(arguments);
            }
            gtag('js', new Date());
            gtag('config', 'UA-127293191-1');
        </script>
    </head>
    <body>
        <div class="book with-summary">
            <div class="book-summary">
                <nav role="navigation">
                    <ul class="summary">
                        <li class="header title" style="text-align: center;">
                            <a href="/">
                                Christophers Tips
                            </a>
                        </li>
                        <li class="divider">
                        </li>
                        <input id="search" placeholder="search.." style="padding:10px 15px;margin:10px 15px;width:235px;">
                        <li class="divider">
                        </li>
                        <div id="accordion">
                            <li class="header accordion-toggle">
                                MISC
                            </li>
                            <div class="accordion-content ">
                                <li class="chapter ">
                                    <a href="/pages/make_this_site.html">
                                        Make this Site
                                    </a>
                                </li>
                                <li class="chapter ">
                                    <a href="/pages/setup_a_mac.html">
                                        Mac Setup
                                    </a>
                                </li>
                                <li class="chapter ">
                                    <a href="/pages/mac_setup_vpn.html">
                                        VPN on Mac
                                    </a>
                                </li>
                            </div>
                            <li class="header accordion-toggle">
                                Development
                            </li>
                            <div class="accordion-content ">
                                <li class="chapter ">
                                    <a href="/pages/Mac_Django_Setup.html">
                                        Django on Mac
                                    </a>
                                </li>
                                <li class="chapter ">
                                    <a href="/pages/ubuntu_server.html">
                                        Ubuntu Server
                                    </a>
                                </li>
                                <li class="chapter ">
                                    <a href="/pages/git.html">
                                        Git
                                    </a>
                                </li>
                                <li class="chapter ">
                                    <a href="/pages/ubuntu_kiosk.html">
                                        Ubuntu Kiosk
                                    </a>
                                </li>
                            </div>
                            <li class="header accordion-toggle">
                                Database Connections
                            </li>
                            <div class="accordion-content ">
                                <li class="chapter ">
                                    <a href="/pages/cx_oracle_ubuntu.html">
                                        Ubuntu CX Oracle
                                    </a>
                                </li>
                                <li class="chapter ">
                                    <a href="/pages/cxoracle_mac.html">
                                        Mac CX Oracle
                                    </a>
                                </li>
                                <li class="chapter ">
                                    <a href="/pages/pyodbc_mac.html">
                                        Mac pyodbc
                                    </a>
                                </li>
                                <li class="chapter ">
                                    <a href="/pages/postgres_db_mac.html">
                                        Mac Postgres
                                    </a>
                                </li>
                                <li class="chapter ">
                                    <a href="/pages/postgres_db_ubuntu.html">
                                        Ubunto Postgres
                                    </a>
                                </li>
                                <li class="chapter ">
                                    <a href="/pages/pyodbc_ubuntu.html">
                                        Ubuntu pyodbc
                                    </a>
                                </li>
                            </div>
                            <li class="header accordion-toggle">
                                Natural Health
                            </li>
                            <div class="accordion-content ">
                                <li class="chapter ">
                                    <a href="/pages/hair_putty.html">
                                        Hairputty
                                    </a>
                                </li>
                            </div>
                            <li class="header accordion-toggle">
                                Projects
                            </li>
                            <div class="accordion-content ">
                                <li class="chapter ">
                                    <a href="/pages/slippers.html">
                                        Slippers
                                    </a>
                                </li>
                            </div>
                            <li class="header accordion-toggle">
                                Code Server
                            </li>
                            <div class="accordion-content default">
                                <li class="chapter active">
                                    <a href="/pages/gitea_setup.html">
                                        Gitea Setup
                                    </a>
                                </li>
                                <li class="chapter ">
                                    <a href="/pages/gitea_customization.html">
                                        Gitea Customization
                                    </a>
                                </li>
                            </div>
                            <li class="divider">
                            </li>
                        </div>
                    </ul>
                </nav>
            </div>
            <div class="book-body">
                <div class="body-inner">
                    <div class="book-header" role="navigation">
                        <a aria-label="" class="btn pull-left js-toolbar-action" href="#">
                            <i class="fa fa-align-justify">
                            </i>
                        </a>
                        <!-- Title -->
                        <h2>
                            <a href="/">
        Christophers Tips
                            </a>
                        </h2>
                    </div>
                    <div class="page-wrapper" role="main" tabindex="-1">
                        <div class="page-inner">
                            <section class="normal markdown-section">
                                <h1>
                                    Setup Gitea Code Repositories
                                </h1>
                                <p>
                                    Special thanks to
                                    <a href="https://bryangilbert.com/post/devops/how-to-setup-gitea-ubuntu/">
                                        Bryan Gilbert
                                    </a>
                                    , whos tutorial this writeup is based on.
                                </p>
                                <h1>
                                    Create Git User
                                </h1>
                                <p>
                                    Login to the server. In this case we are using Ubuntu 18.
                                </p>
                                <p>
                                    Create a user account "git" which will be used by gitea. There will be no password, but will have a home directory.
                                </p>
                                <pre><code>sudo adduser --system --shell /bin/bash --group --disabled-password --home /home/git git

</code></pre>
                                <h1>
                                    Create Database
                                </h1>
                                <p>
                                    Install postgresql.
                                </p>
                                <pre><code>sudo apt install postgresql
</code></pre>
                                <h2>
                                    Create DB User
                                </h2>
                                <p>
                                    Start sql session.
                                </p>
                                <pre><code>sudo su postgres
psql
</code></pre>
                                <p>
                                    Create user and database.
                                </p>
                                <pre><code>CREATE USER gitea WITH PASSWORD '&lt;password&gt;';
CREATE DATABASE gitea OWNER gitea;
# exit postgres.
\q
</code></pre>
                                <h2>
                                    Tune the DB
                                </h2>
                                <p>
                                    We will make a few tweaks to postgres config.
                                </p>
                                <p>
                                    Open the conf file.
                                </p>
                                <pre><code>sudo nano /etc/postgresql/10/main/postgresql.conf
</code></pre>
                                <p>
                                    Set shared_buffers to 25% of total ram. Example: with 4gb ram:
                                </p>
                                <pre><code>shared_buffers= 1024MB

# other settings:
max_connections= 500
track_counts= on
autovacuum= on
work_mem= 4MB
</code></pre>
                                <p>
                                    Restart db.
                                </p>
                                <pre><code>sudo service postgresql restart
</code></pre>
                                <h1>
                                    Install Gitea
                                </h1>
                                <p>
                                    Next, we can install Gitea. You can get the current version number from
                                    <a href="https://github.com/go-gitea/gitea/releases">
                                        gitea
                                    </a>
                                    .
                                </p>
                                <pre><code># change user to git
sudo su git

# make gitea directory
cd /home/git &amp;&amp; mkdir gitea &amp;&amp; cd gitea

# copy in the latest version of gitea
wget -O gitea https://dl.gitea.io/gitea/1.8.2/gitea-1.8.2-linux-amd64

# change permissions
chmod +x gitea

# exit git account
exit
</code></pre>
                                <p>
                                    The gitea server can be run manually for testing if needed. The installation can be finished at this point as well, but we will wait until nginx is running first.
                                </p>
                                <pre><code>./gitea web
</code></pre>
                                <h1>
                                    Setup Gitea Service
                                </h1>
                                <p>
                                    Next a service needs to be created to keep Gitea running, and restart it when the server restarts.
                                </p>
                                <pre><code>sudo nano /etc/systemd/system/gitea.service
</code></pre>
                                <p>
                                    Enter the service information.
                                </p>
                                <pre><code>[Unit]
Description=Gitea (Git with a cup of tea)
After=syslog.target
After=network.target
After=postgresql.service

[Service]
RestartSec=2s
Type=simple
User=git
Group=git
WorkingDirectory=/home/git/gitea
ExecStart=/home/git/gitea/gitea web
Restart=always
Environment=USER=git HOME=/home/git

[Install]
WantedBy=multi-user.target
</code></pre>
                                <p>
                                    Enable and start the service.
                                </p>
                                <pre><code>sudo systemctl enable gitea.service
sudo systemctl start gitea.service
</code></pre>
                                <h1>
                                    Setup Nginx
                                </h1>
                                <p>
                                    Install.
                                </p>
                                <pre><code>sudo apt install nginx
</code></pre>
                                <p>
                                    Create the Nginx site.
                                </p>
                                <pre><code>sudo nano /etc/nginx/sites-enabled/gitea
</code></pre>
                                <p>
                                    Enter server information.
                                </p>
                                <pre><code>server {
                listen 80;
    server_name &lt;your-domain or IP address&gt;;

    location / {
    proxy_pass http://localhost:3000;
    }

    proxy_set_header X-Real-IP $remote_addr;
}
</code></pre>
                                <p>
                                    Finally, remove the default Nginx site and reload Nginx.
                                </p>
                                <pre><code>sudo rm /etc/nginx/sites-enabled/default
sudo service nginx reload
</code></pre>
                                <p>
                                    Change the upload limit size in Nginx.
                                </p>
                                <pre><code>sudo nano /etc/nginx/nginx.conf
# change this line to the size you need. If line is not there, add to the http {} section.
client_max_body_size = 100M;
</code></pre>
                                <p>
                                    Restart Nginx.
                                </p>
                                <pre><code>service nginx restart
</code></pre>
                                <h1>
                                    Completed Installation
                                </h1>
                                <p>
                                    Now you can navigate to the website and complete installation. You will need to enter the db password, etc.
                                </p>
                                <p>
                                    https://docs.gitea.io/en-us/customizing-gitea/
                                </p>
                                <p style="border-top: solid rgba(0, 0, 0, .07) 1px;padding-top: 20px;">
                                    <span style="font-size: 90%;float: left; height:30px;">
                                        <small>
                                            Last updated July 26,2019
                                        </small>
                                    </span>
                                    <span class="footer-links">
                                        <a href="https://github.com/christopherpickering" style="padding-right:20px;">
                                            <i class="fab fa-github">
                                            </i>
                                        </a>
                                        <a href="https://code.christophers.tips" style="padding-right: 20px;">
                                            <i class="fas fa-code">
                                            </i>
                                        </a>
                                        <script id="emailsafety" type="text/javascript">
                                            emailE = 'gmail.com';
                                            emailE = ('pher122s' + '@' + emailE);
                                            document.write('<a href="mailto:' + emailE + '"> <i class="fas fa-envelope" style="padding-right: 20px;"></i></a>');
                                        </script>
                                        <script>
                                            element = document.getElementById("emailsafety");
                                            if (element) {
                                                element.parentNode.removeChild(element);
                                            }
                                        </script>
                                        <noscript>
                                            <a href="#">
                                                <i class="fas fa-envelope" style="padding-right: 20px;">
                                                </i>
                                            </a>
                                        </noscript>
                                        <a href="https://www.linkedin.com/in/christopher-pickering-14bb8810b/">
                                            <i class="fab fa-linkedin">
                                            </i>
                                        </a>
                                    </span>
                                </p>
                            </section>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- jquery -->
        <script src="/static/js/jquery.js">
        </script>
        <script src="/static/js/CACHE/eec41.js">
        </script>
    </body>
</html>
