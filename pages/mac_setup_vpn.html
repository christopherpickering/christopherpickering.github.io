<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta content="IE=edge" http-equiv="X-UA-Compatible">
        <meta content="width=device-width" name="viewport">
        <meta content="true" name="HandheldFriendly">
        <meta content="yes" name="apple-mobile-web-app-capable">
        <meta content="black" name="apple-mobile-web-app-status-bar-style">
        <link href="/static/img/favicon.ico" rel="icon">
        <!-- site properties -->
        <title>
   Christophers Tips
        </title>
        <meta content="" name="description">
        <meta content="Christopher Pickering" name="author">
        <meta content="" name="keywords">
        <!-- typekit -->
        <link href="https://use.typekit.net/wtg5gdq.css" rel="stylesheet">
        <!-- styles -->
        <link href="/static/css/CACHE/755f7.css" rel="stylesheet">
        <link href="/static/css/CACHE/a9932.css" rel="stylesheet">
        <!-- fontawesome -->
        <!--<link rel="stylesheet" href="/static/css/all.css">-->
        <!-- google analytics -->
        <script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-127293191-1">
        </script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() {
                dataLayer.push(arguments);
            }
            gtag('js', new Date());
            gtag('config', 'UA-127293191-1');
        </script>
    </head>
    <body>
        <div class="book with-summary">
            <div class="book-summary">
                <nav role="navigation">
                    <ul class="summary">
                        <li class="header title" style="text-align: center;">
                            <a href="/">
                                Christophers Tips
                            </a>
                        </li>
                        <li class="divider">
                        </li>
                        <input id="search" placeholder="search.." style="padding:10px 15px;margin:10px 15px;width:235px;">
                        <li class="divider">
                        </li>
                        <div id="accordion">
                            <li class="header accordion-toggle">
                                MISC
                            </li>
                            <div class="accordion-content default">
                                <li class="chapter ">
                                    <a href="/pages/make_this_site.html">
                                        Make this Site
                                    </a>
                                </li>
                                <li class="chapter ">
                                    <a href="/pages/setup_a_mac.html">
                                        Mac Setup
                                    </a>
                                </li>
                                <li class="chapter active">
                                    <a href="/pages/mac_setup_vpn.html">
                                        VPN on Mac
                                    </a>
                                </li>
                            </div>
                            <li class="header accordion-toggle">
                                Development
                            </li>
                            <div class="accordion-content ">
                                <li class="chapter ">
                                    <a href="/pages/Mac_Django_Setup.html">
                                        Django on Mac
                                    </a>
                                </li>
                                <li class="chapter ">
                                    <a href="/pages/ubuntu_server.html">
                                        Ubuntu Server
                                    </a>
                                </li>
                                <li class="chapter ">
                                    <a href="/pages/git.html">
                                        Git
                                    </a>
                                </li>
                                <li class="chapter ">
                                    <a href="/pages/ubuntu_kiosk.html">
                                        Ubuntu Kiosk
                                    </a>
                                </li>
                            </div>
                            <li class="header accordion-toggle">
                                Database Connections
                            </li>
                            <div class="accordion-content ">
                                <li class="chapter ">
                                    <a href="/pages/cx_oracle_ubuntu.html">
                                        Ubuntu CX Oracle
                                    </a>
                                </li>
                                <li class="chapter ">
                                    <a href="/pages/cxoracle_mac.html">
                                        Mac CX Oracle
                                    </a>
                                </li>
                                <li class="chapter ">
                                    <a href="/pages/pyodbc_mac.html">
                                        Mac pyodbc
                                    </a>
                                </li>
                                <li class="chapter ">
                                    <a href="/pages/postgres_db_mac.html">
                                        Mac Postgres
                                    </a>
                                </li>
                                <li class="chapter ">
                                    <a href="/pages/postgres_db_ubuntu.html">
                                        Ubunto Postgres
                                    </a>
                                </li>
                                <li class="chapter ">
                                    <a href="/pages/pyodbc_ubuntu.html">
                                        Ubuntu pyodbc
                                    </a>
                                </li>
                            </div>
                            <li class="header accordion-toggle">
                                Natural Health
                            </li>
                            <div class="accordion-content ">
                                <li class="chapter ">
                                    <a href="/pages/hair_putty.html">
                                        Hairputty
                                    </a>
                                </li>
                            </div>
                            <li class="header accordion-toggle">
                                Projects
                            </li>
                            <div class="accordion-content ">
                                <li class="chapter ">
                                    <a href="/pages/slippers.html">
                                        Slippers
                                    </a>
                                </li>
                            </div>
                            <li class="header accordion-toggle">
                                Code Server
                            </li>
                            <div class="accordion-content ">
                                <li class="chapter ">
                                    <a href="/pages/gitea_setup.html">
                                        Gitea Setup
                                    </a>
                                </li>
                                <li class="chapter ">
                                    <a href="/pages/gitea_customization.html">
                                        Gitea Customization
                                    </a>
                                </li>
                            </div>
                            <li class="divider">
                            </li>
                        </div>
                    </ul>
                </nav>
            </div>
            <div class="book-body">
                <div class="body-inner">
                    <div class="book-header" role="navigation">
                        <a aria-label="" class="btn pull-left js-toolbar-action" href="#">
                            <i class="fa fa-align-justify">
                            </i>
                        </a>
                        <!-- Title -->
                        <h2>
                            <a href="/">
        Christophers Tips
                            </a>
                        </h2>
                    </div>
                    <div class="page-wrapper" role="main" tabindex="-1">
                        <div class="page-inner">
                            <section class="normal markdown-section">
                                <h1>
                                    How To Use VPN on an Intranet
                                </h1>
                                <p>
                                    Why use a VPN? The VPN will keep your network traffic secure between you and the host and will make snooping very challenging. The downside of a VPN is that all traffic from your computer is routed to the VPN host and you loose access to servers/websites that are on the local network.
                                </p>
                                <p>
                                    These steps will help to make a VPN doable
                                </p>
                                <h2>
                                    Installs
                                </h2>
                                <ul>
                                    <li>
                                        <a href="https://protonvpn.com">
                                            ProtonVPN
                                        </a>
                                    </li>
                                    <li>
                                        <a href="https://apps.apple.com/us/app/helm-hosts-file-manager/id1099472017?mt=12">
                                            Helm
                                        </a>
                                        or another hosts manager
                                    </li>
                                </ul>
                                <h2>
                                    How To
                                </h2>
                                <p>
                                    Running intranet sites while on a VPN can be painful, but with a few steps can be conquered.
                                </p>
                                <p>
                                    First install ProtonVPN and Helm.
                                </p>
                                <p>
                                    ProtonVPN is the VPN of our choice.
                                </p>
                                <p>
                                    Helm is used to easly manage hosts. We can have several profiles in there.
                                </p>
                                <h3>
                                    Create Network Routes
                                </h3>
                                <p>
                                    When you are running a VPN all network traffic is routed out to the VPN host. This means that you will not be able to access intranet sites anymore, or any sites that are specific to the network you are using.
                                </p>
                                <p>
                                    Thankfully your mac has an option to router network traffic to specific hosts and bypass the VPN if needed!
                                </p>
                                <p>
                                    A network route can be easily added. Heres an example that will reroute all 10.x.x.x traffic through 11.0.0.1:
                                </p>
                                <pre><code>sudo route -n add -net 10.0.0.0 11.0.0.1
</code></pre>
                                <p>
                                    The problem is that when your mac restarts it will reset the routes!
                                </p>
                                <p>
                                    We need to make a script that will add the routes each time your mac restarts.
                                </p>
                                <h4>
                                    Create Route Script
                                </h4>
                                <p>
                                    In your favorite script location make a new script.
                                </p>
                                <pre><code>cd fav_script_location
nano route_script
</code></pre>
                                <p>
                                    Add in the routes to add. You can find all the route syntax options by running
                                    <code>
                                        man route
                                    </code>
                                    .
                                </p>
                                <p>
                                    the basic syntax is
                                </p>
                                <pre><code>add route ip_address gateway_address
</code></pre>
                                <p>
                                    I include the -n so network names are not looked up when adding the route, and also -net which will allow a base address to include matches. For example -net 10.0.0.0 will include 10.1.0.0. The last three zeros are basically wild cards in the ip addresses.
                                </p>
                                <p>
                                    To find the local gateway run
                                    <code>
                                        netstat -rn
                                    </code>
                                    with the VPN off. The default destination will have a gateway IP address for you LAN.
                                </p>
                                <p>
                                    When completed your script may look like this:
                                </p>
                                <pre><code>#!/bin/sh
route -n add -net 10.0.0.0 10.1.123.1
route -n add -net 10.1.233.1 10.1.123.1
</code></pre>
                                <p>
                                    Change permissions for script.
                                </p>
                                <pre><code>chmod +x route_script
</code></pre>
                                <h4>
                                    Add plist To Run Script on Startup
                                </h4>
                                <p>
                                    The plist needs to be in
                                    <code>
                                        /Library/LaunchDaemons
                                    </code>
                                    to be pickedup.
                                </p>
                                <pre><code>nano /Library/LaunchDaemons/com.route_script.plist
</code></pre>
                                <p>
                                    Add in the content.
                                </p>
                                <pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;
&lt;plist version="1.0"&gt;
&lt;dict&gt;
&lt;key&gt;Label&lt;/key&gt;
&lt;string&gt;com.route_script.plist&lt;/string&gt;
&lt;key&gt;Program&lt;/key&gt;
&lt;string&gt;fav_script_location/route_script&lt;/string&gt;
&lt;key&gt;StandardErrorPath&lt;/key&gt;
&lt;string&gt;fav_script_location/route_script.err&lt;/string&gt;
&lt;key&gt;StandardOutPath&lt;/key&gt;
&lt;string&gt;fav_script_location/route_script.out&lt;/string&gt;
&lt;key&gt;RunAtLoad&lt;/key&gt;
&lt;true/&gt;
&lt;key&gt;StartInterval&lt;/key&gt;
&lt;integer&gt;3600&lt;/integer&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</code></pre>
                                <p>
                                    Set the script to launch on startup.
                                </p>
                                <pre><code>sudo chown root /Library/LaunchDaemons/com.route_script.plist
sudo launchctl load /Library/LaunchDaemons/com.route_script.plist
</code></pre>
                                <p>
                                    To test if the route are working you can manually start the plist, or restart your mac and run
                                    <code>
                                        netstat -rn
                                    </code>
                                    . Your new rout should be listed in there!
                                </p>
                                <p>
                                    To manually launch plist:
                                </p>
                                <pre><code>sudo launchclt start com.route_script.plist
</code></pre>
                                <p>
                                    If it does not start, open mac app "console" and check for any messages in the system.log section. You will find details of the errors in the paths specified for logging in the plist paths you created for logging.
                                </p>
                                <h3>
                                    Setup Hosts
                                </h3>
                                <p>
                                    Finally, the last step is to configure Helm with your hosts. Click the icon in the menu bar and follow instructions.
                                </p>
                                <h2>
                                    Test
                                </h2>
                                <p>
                                    Turn on the VPN and try to access the local sites!
                                </p>
                                <p style="border-top: solid rgba(0, 0, 0, .07) 1px;padding-top: 20px;">
                                    <span style="font-size: 90%;float: left; height:30px;">
                                        <small>
                                            Last updated July 2,2019
                                        </small>
                                    </span>
                                    <span class="footer-links">
                                        <a href="https://github.com/christopherpickering" style="padding-right:20px;">
                                            <i class="fab fa-github">
                                            </i>
                                        </a>
                                        <a href="https://code.christophers.tips" style="padding-right: 20px;">
                                            <i class="fas fa-code">
                                            </i>
                                        </a>
                                        <script id="emailsafety" type="text/javascript">
                                            emailE = 'gmail.com';
                                            emailE = ('pher122s' + '@' + emailE);
                                            document.write('<a href="mailto:' + emailE + '"> <i class="fas fa-envelope" style="padding-right: 20px;"></i></a>');
                                        </script>
                                        <script>
                                            element = document.getElementById("emailsafety");
                                            if (element) {
                                                element.parentNode.removeChild(element);
                                            }
                                        </script>
                                        <noscript>
                                            <a href="#">
                                                <i class="fas fa-envelope" style="padding-right: 20px;">
                                                </i>
                                            </a>
                                        </noscript>
                                        <a href="https://www.linkedin.com/in/christopher-pickering-14bb8810b/">
                                            <i class="fab fa-linkedin">
                                            </i>
                                        </a>
                                    </span>
                                </p>
                            </section>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- jquery -->
        <script src="/static/js/jquery.js">
        </script>
        <script src="/static/js/CACHE/eec41.js">
        </script>
    </body>
</html>
